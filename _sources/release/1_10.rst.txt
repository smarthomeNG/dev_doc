=============================
Release 1.10.x - tt. mmm 2023
=============================

Dieses Release ist ein Wartungs-Release. Außer Bugfixes gibt es einige neue Features im Core von SmartHomeNG,
sowie einige neue Plugins.

.. only: comment

    Dieses Release ist ein Feature-Release. Es gibt eine Menge neuer Features im Core von SmartHomeNG und den Plugins.

|

    .. only:: comment

    .. note::

        Diese Release Notes sind ein Arbeitsstand.

         - Berücksichtigt sind Commits im smarthome Repository bis incl. 29. August 2023
           (Bugfix in dict handling)
         - Berücksichtigt sind Commits im plugins Repository bis incl. 28. August 2023
           (...)


Überblick
=========

Dieses ist neues Release für SmartHomeNG. Die Änderungen gegenüber dem Release v1.9.5 sind im
folgenden in diesen Release Notes beschrieben.


Minimum Python Version
----------------------

Die absolute Minimum Python Version in der SmartHomeNG startet, ist **Python 3.7**.

Für das SmartHomeNG Release 1.10 wird die absolute Minimum Python Version auf **Python 3.8** angehoben, da der
Community Support für Python 3.7 am 27. Juni 2023 endete.

Bei einer Neuinstallation wird jedoch empfohlen auf einer der neueren Python Versionen (3.9 oder 3.10) aufzusetzen.


Unterstützte Python Versionen
-----------------------------

Die älteste offiziell unterstützte Python Version für SmartHomeNG Release 1.10.x ist **Python 3.8**.
Automatisierte Tests von SmartHomeNG werden nur in den unterstützten Python Versionen durchgeführt.
(Siehe auch :ref:`Hard- u. Software Anforderungen <python_versionen>` im Abschnitt **Installation**
zu unterstützten Python Versionen)

|

.. _Änderungen_am_core::

Änderungen am Core
==================

Allgmein
--------

* Workflows:

  * ...

* venvs: Scripts for creation and activation of virtual environments


Updates im CORE
---------------

* bin.smarthome:

  * Replaced th deprecated function getdefaultlocale()

* Libs:

  * lib.backup:

    * Added structs directory to configuration backup and restore
    * Included requirements.txt file for userfunctions and logics

  * lib.db:

    * Suppress an error log message, if database is new and empty

  * lib.env:

    * New lib with support functions for environmental calculations
    * Added descriptions for system logics
    * Integration in eval-statements and logics

  * lib.item:

    * Implementation of the hysteresis attributes for items
    * Documentation of hysteresis attributes
    * Implemented timer for hysteresis items
    * Implemented multi level nesting of structs, if they are included on the top level of a struct
    * Implemented multi level nesting of structs, even they are included on a deeper level of a struct
    * Hysteresis Items can be configured with eval expressions instead of absolute numeric values or item references
    * Attribute autotimer now supports eval expressions; Attribute autotimer is working without specification of
      a value (again)
    * Attribute cycle now supports eval expressions; Attribute cylce is working without specification of a value (again)
    * Corrected Call order of __run_attribute_eval() and _cast_duration() for autotimer
    * Extended configuration options for autotimer (duration)
    * Corrected Call to __run_attribute_eval() and _cast_duration() for autotimer
    * structs: Added relative reference to sub-struct from same file (struct name starts with a period)
    * Implemented attributes with variables (attribut reference) in attribute value; attribute references now
      include attributes from current item to great-grandparent item
    * Allow attribute-vars in name attribute
    * Implemented loading structs from ../structs directory
    * structs: Implemented automatic migration from /etc to /structs
    * eval on trigger only implemented
    * Initial support for access to elements of list and dict items
    * Bugfix in dict handling

  * lib.log:

    * Improvements to logging configuration
    * Added import logging.config (to keep mockup core from failing)

  * lib.logic:

    * Logic list can now be grouped. Logics can be assigned to one or more groups

  * lib.metadata:

    * Changed one loglevel from warning to notice (to test mockup core)
    * Added prefix '_' for "internal" attributes to allow using these attributes without warnings

  * lib.model:

    * Added SmartDevicePlugin (sdp) and documentation
    * sdp:

      * Add standby mode
      * Added do_before_send method
      * Update sdp connections for standby
      * Update standby mode on failed connect and reconnect
      * Update sdp serial connections
    * SmartPlugin:

      * move suspend/resume function to smartplugin
      * Suspend/resume API für SmartPlugin
      * New parameter 'mode' for get_item_list() implemented

    * MqttPlugin:

      * Fixed implementation of webinterface

  * lib.network:

    * Fix name reference
    * Small fixes
    * Add open method

  * lib.plugin:

    * Added get method to plugins class
    * Bumped core version to 1.9.5.2

  * lib.scheduler:

    * Implemented a single logger for tasks (before, each task created it's own logger, resulting
      in hundreds or thousands of active loggers)
    * Added some error handling
    * Bugfix for giving parameters to a task via scheduler.add()

  * lib.shpypi:

    * Small updates for changed messages of pip commend
    * Included userfunctions and logics. Directories for both can contain a requirements.txt file which is
      now loaded and interpreted

  * lib.shtime:

    * Added function to_seconds() which converts a string (e.g. '2h5m25s') to seconds (integer)

  * lib.systeminfo:

    * Fix issues with some Mac OS X versions on startup

  * lib.translate:

    * Enhanced translation capabilities

* Modules:

  * admin:

    * Bugfix for new loglevels in list of loggers
    * api_loggers: Converting all entries of filters list of loggers to strings to be JSON serializable
    * Adjusted log levels
    * shngadmin:

      * v0.6.7: Added "Add Logger" and "Remove Logger" for plugins to list of loggers page
      * v0.7.0: Added "Add Logger" and "Remove Logger" for logics, items and advanced loggers to
        'list of loggers' page
      * v0.7.2: Added "Modify Handlers" to loggers configuration page
      * v0.7.3: Added hysteresis attributes to shngadmin
      * v0.7.8: Logic list can now be grouped. Logics can be assigned to one or more groups
      * v0.7.12, modules.admin.api_logics, lib.logic: Added description for groups; Small fixes
      * v0.8.1.: First version using the adm payload protocol for websocket communication
      * v0.8.5:

        * Implemented item Monitoring
        * Implemented adm payload protocol for websocket communication (used by resource graphs)
        * Completed logics-list
      * v0.8.6 small modifications on services tab and logics listing
      * v0.8.8:

        * Now keeping grouped list of logics expanded when changing tabs
        * Added item description to details in item-tree view
      * v0.8.10:

        * Keeping groups expanded on logic-list
        * Added description attribute to item details
        * In Logger configuration sub-loggers of a plugin are en-/disabled with the plugin logger
      * v0.8.17 Implemented load logics from editor page after it has been unloaded due to error
      * v0.9.1: Adding, changing and deleting of logic-groups implemented
      * v0.9.2: In item-details show logic-description for connected logics
      * v0.9.3: Fix for display of items/struct templates

    * Caught an error in eval syntax checker, if result could not be converted to json

  * http:

    * Added initial support for hosting a visu by a plugin
    * Modification of hostmaps for rest interface on newer cherrypy packages
    * Added requirement of cherrypy 18.8.9 for Python 3.11 and allowed newer versions of cheroot
    * Use correct config for services, removed /msgS to make services urls working again
    * for webinterfaces:
      * Remove window.resize on click on responsive "+" sign
      * Only update page resize and headtable calculation if respective elements are available
      * Introduce sorting icons that can be used by plugins (outside of datatables)
      * Introduce set_cookie and get_cookie functions that can be used in plugins for storing values
      * use cookies to store and read automatic update of datatables
      * Update popper.js and provide easy way to integrate tooltips in web interfaces by using createTooltips function
      * Add popper.css
      * Update jquery to 3.7.0 and jquery-ui to 1.13.2
      * Update datatables incl. modules and datetime-moment
      * Add sorting icons for num values
      * Update documentation.. add info on tooltips, datepicker, cookies, icons
      * Update sample plugin to include cookies and tooltips
      * Updates to datatables and pageresize
      * Update to base_plugin.html to support bordered tab data

  * mqtt:

    * Added datatype 'dict/str' for subscribing to messages containing a payload with uncertain data type

  * websocket:

    * Fix for smartvisu payload protocol
    * Implementation of first version of the adm payload protocol

* Plugins:

  * ...

* tests:

  * Added extended loglevels to mock/core
  * Extended mockup core

|

Änderungen bei Plugins
======================

Allgmein
--------

* Workflows:

  * Fix unittest for forked repos


.. _releasenotes_1_10_neue_plugins:

Neue Plugins
------------

Für Details zu den neuen Plugins, bitte die Dokumentation des jeweiligen Plugins unter
http://www.smarthomeng.de/user/plugins_all.html konsultieren.

* denon: For Denon AV Receivers, based on SmartDevicePlugin
* epson: Based on SDP control of Epson projectors are supported (minimal setup for now)
* lms: Logitech Mediaserver / Squeezebox, based on SmartDevicePlugin
* pioneer: for Pioneer AV Receivers, based on SmartDevicePlugin
* oppo: First version of SmartDevicePlugin based plugin for Oppo UHD players
* byd_bat: Plugin to display data from BYD batteries


.. _releasenotes_1_10_updates_plugins:

Plugin Updates
--------------

Für Details zu den Änderungen an den einzelnen Plugins, bitte die Dokumentation des jeweiligen Plugins unter
http://www.smarthomeng.de/user/plugins_all.html konsultieren.

* alexarc4shng:

  * Small bug-fix in Web-IF
  * Fixed issues with urlencode

* appletv:

  * Use separate webif/init for web interface integration
  * Integrate external webif file
  * Introduce some error handling if no "real" AppleTV is found
  * Introduce item attributes in metadata, fix struct (item should not be named type - renamed to media_type)
  * Bump to version 1.6.2
  * Replace README with user_doc
  * Adjust requirements to work with Python 3.10
  * Fix module imports for web interface
  * Added requirement to circumvent problematic requirements of pyatv package under Python 3.11
  * Clean up user_doc
  * Improve error handling and logging

* avdevice:

  * Fix dependency function for int/float values

* avm:

  * raise exception if no connection to fritzdevice, fritzhome or callmonitor is possible
  * make plugin parameter 'host' mandatory
  * Catch exception if node value returns empty value (e.g. happens if plugin tries to read in color temperature
    value of RGB light when beeing in RGB not white mode)
  * Improved plugin shutdown fixing "Thread *.poll_tr064, still alive" warning
  * Improve exception handling during init of devices
  * Disable tab5 (Logs) for Devices without AHA-Interface
  * Improve stop of plugin
  * Bugfix setting Fritzdevice like start_call'
  * Optimize "get_logs" to prevent older fritz-devices from timeout
  * Use get_logs_from tr-064 as backup solution
  * Increase request timeout if timeout occurred
  * Trying to fix yet another regression in avm RGB support introduced with release v1.9.5
  * Removed 'optional' text in mandatory plugin host attribute
  * Automate creation of item_attributes.py and update of valid_list of avm_data_type in plugin.yaml by scripts
    included in item_attributes_master.py
  * Bugfix of update of valid_list of avm_data_type in plugin.yaml by
  * Create valid_list_description in metadata
  * Bugfix and Extension of get_hosts
  * Make use of standard methods of class SmartPlugin for item handling/storage
  * Improve Fritz_Home
  * Exception Classes & Minor Fixes
  * FritzHome: Bugfix renewing SID in case SID has expired
  * CallMonitor: bugfix join listing thread
  * CallMonitor: reconnect if connection is lost
  * Bump to 2.0.9
  * CallMonitor: bugfix join counter threads
  * FritzHome: Add support for device statistics
  * bump to 2.1.0

* beolink:

  * Changes to translations

* database:

  * Changed log message, if no cache value was found
  * Added option 'no' to valid list of database attribute

* db_addon:

  * Lock database for query and release if afterwards
  * Item parameter'db_addon_startup' can now be used also directly at database_item; 'db_addon_startup' will be
    set for all child items
  * new item parameter 'db_addon_ignore_value_list' to allow list of comparision operators to be used for database query
  * Improve coding für _handle_waermesumme and _handle_gruenlandtemperatursumme since calculation is almost the same
  * Fix deleting item value cache from webif
  * Bugfix _handle_zaehlerstand
  * Ease queries at _query_log_timestamp (do round in plugin)
  * Add new plugin parameter to define list of comparison operators to be used during database query per
    substring of item_path
  * Bugfix _handle_onchange
  * Bugfix in parse_item
  * Allow to define database_item_path to be defined up to 3 level above db_addon_item
  * Allow to define database_item_path to be defined up to 3 level above db_addon_item (bugfix)
  * Add plugin parameter to enable/disable optimizing defined value filters
  * Enable on-change attributes to be run on startup
  * Bugfix in handle_onchange
  * Code rework to enable more flexible attributes
  * Bump to version 1.2.0 due to significant change in code
  * several fixes
  * bump to v1.2.1
  * Code rework to enable more flexible attributes

* drexelundweiss:

  * Improved error handling
  * Implement plugin logo
  * Clean up init code, bump version to v1.5.4

* enocean:

  * Robustify plugin reaction to loss of Enocean serial device
  * Support RFC2217 connections
  * Expanded user documentation
  * Added serial/ethernet connection status to webinterface
  * Clean-up logging import and unused argument of init function

* executor:

  * Extending base_plugin.html instead of extending base.html in webinterface
  * Fix major issue with autocomplete. Now full item paths are available instead of (non existing) item name references
  * Allow sorting of saved files, minor code improvements
  * Re-write autocomplete method using worker and promise functions. Now the plugin can be used immediately
    without having to wait for fetching the autocomplete dict.
  * Fix autocomplete dict. Previously (sub)items called "id" were fetched wrongly
  * Fix and extend user_doc
  * Bump version to 1.2.0
  * Introduce popper.js tooltips for sorting
  * Add two database example scripts
  * Introduce example scripts that can be loaded in the web interface
  * Change order of file list
  * Improve button enable/disable
  * Removed duplicate scroolbars from webinterface
  * Bump to v1.2.1

* gpio:

  * Fix user_doc reference to configuration

* homeconnect:

  * Added requests-oauthlib to requirements

* hue2:

  * Adjusted requirements for zeroconf package
  * Changed requirements for zeroconf

* husky2:

  * Minor updates

* ical:

  * Reduced warning log indicating event with no summary entry to info level

* indego4shng:

  * Update to 4.0.1 including single-key-id login

* knx:

  * Prevent send actions to bus while plugin is not running
  * Fix issue with polling knx items on startup. All polls are put in a waiting list and polled on run only
  * Corrected a translation

* modbus_tcp:

  * Fixed bug

* neato:

  * Clean-up unused argument of init function

* network:

  * Remove debug print

* nut:

  * Added user_doc, default logo and refined plugin.yaml
  * Clean-up unused argument of init function, switched to parameter import via method get_parameter_value()
  * Bugfix for exception that can occur during termination of the plugin

* philips_tv:

  * Added support for ambilight control
  * Clean-up unused argument of init method

* pioneer:

  * Update plugin.yaml to make suspend_item and retry_suspend available.

* piratewthr:

  * Adjusted log mesages
  * Bumped version to 1.1.2
  * piratewthr: Improved log messages in case of piratewther server errors
  * Added windDirectionString to struct
  * Minimum core version is now 1.9.5.2
  * Removed 'database_maxage: 731' from struct items to use default of database plugin
  * Bumped version to 1.2.0
  * Added locals.location to struct
  * Reworked structs to use new features
  * Modified to use lib.env

* rcs1000n:

  *Restructure send method and improve try/except clause

* resol:

  * Improved user_doc
  * Clean-up unused argument of init method

* rpi_info:

  * Update and fix web interface

* shelly:

  * Initial version of plugin with Gen2 api support

* smartvisu:

  * Changed default value for generate_pages to False
  * Corrected log message
  * Only check dir if handling option is set
  * Adjust empty dir handling

* solarforecast:

  * Fallback to smarthomeNG lat/long default values if no plugin specific latitude and longitude values are specified
  * Fix for plugin.yaml, lat, lon are now interpreted as strings not numbers (backward compatible)
  * Fix for fallback to system location as a plugin default value
  * Replaced deprecated sh.now() with method of lib shtime
  * Clean-up unused argument of init method

* sonos:

  * Improved thread termination; reintroduced old legacy method play_radio

* stateengine:

  * Keep variables after state evaluation so they can be used in enter Conditions
  * Fix major problem with internal structs
  * Temporarily set state_name and state_id on init
  * Adjust docu accordingly regarding current.state_name variable
  * Bump version to 1.9.6
  * Update struct and logging
  * (re)introduce separate loggers for each stateengine item. Custom logger stateengine.<item>.rules

* tankerkoenig:

  * Fix for get_petrol_stations(), if tankerkoenig.de did not return any information
  * Added check for Nonetype results
  * Extend error message to show raw response

* tasmota:

  * Change item handling to new smartplugin method using  _plg_item_dict
  * Bugfix item handling to new smartplugin method using  _plg_item_dict
  * Bugfix interview_all_devices
  * Improve RF-Bridge
  * Allow send of learned keys
  * Improve of using ZigbeeDevice Shortname
  * Improve handling of received messages and taking info from dicts
  * Bugfix update item with relay
  * Improve exception handling
  * Improve clearing retained messages
  * Revert direct use of _plg_item_dict in WebIF
  * Allow unknown tasmota-attrs, move tasmota-attr doc to user_doc.rst
  * Improve Exception handling and handling of power messages
  * Bump version to 1.5.2

* telegram:

  * New package, use async
  * Revised stop method
  * Bumped version to v1.8.0
  * New_event_loop for multi-instance
  * V2.0.0 Additions in locale; evaluate if debugging
  * Retry sending in case of error (with parameters)
  * Attempt to catch the exception in the updater

* vacations:

  * Update after start
  * Update cycle configurable
  * Accept country "Germany"

* Webservices:

  * Fix for splitting up of autotimer attribute into _value and _time


Outdated Plugins
----------------

Die folgenden Plugins wurden bereits in v1.6 als *deprecated* (veraltet) markiert. Das bedeutet, dass diese
Plugins zwar noch funktionsfähig sind, aber nicht mehr weiter entwickelt werden. Sie werden in einem kommenden
Release von SmartHomeNG entfernt werden. Anwender dieser Plugins sollten auf geeignete Nachfolge-Plugins
wechseln.

* System Plugins

  * sqlite_visu2_8 - switch to the **database** plugin

* Web Plugins

  * wunderground - the free API is not provided anymore by Wunderground - switch to the **piratewthr** or
    **openweathermap** plugin

Außerdem wurden folgende Plugins als *deprecated* markiert:

* Web Plugins

  * darksky - the free API is not provided anymore - switch to the **piratewthr** or **openweathermap** plugin


.. _releasenotes_1_10_retired_plugins:

Retired Plugins
---------------

Die folgenden Plugins wurden *retired* (in den RUhestand geschickt). Sie waren in einem der vorangegangenen
Releases von SmartHomeNG als *deprecated* markiert worden. Diese Plugins wurden aus dem **plugins** Repository
entfernt, stehen jedoch als Referenz weiterhin zur Verfügung. Diese Plugins wurden in das **plugin_archive**
Repositiory aufgenommen.

* Gateway Plugins

  * ecmd
  * elro
  * iaqstick
  * snom
  * tellstick

* Interface Plugins

  * easymeter
  * smawb
  * vr100

* Web Plugins

  * nma

|

Weitere Änderungen
==================

Tools
-----

* Added script 'postinstall' which sets file permissions and cre…ates a virtual environment to run SmartHomeNG in
** checkplugins: catch error when a file resides within plugin directory


Dokumentation
-------------

* Increase version required for sphinx tabs
* Updates to example plugin files


